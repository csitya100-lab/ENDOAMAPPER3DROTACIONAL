

Thought for 11s





√ìtima pergunta! O problema atual √© que ao clicar com o bot√£o esquerdo no modelo 3D, o marcador √© criado imediatamente no pointerdown, impedindo a rota√ß√£o. A solu√ß√£o √© distinguir click (press + release sem mover) de drag (rota√ß√£o).

Vou implementar a l√≥gica: s√≥ criar o marcador no pointerup se o mouse n√£o se moveu significativamente durante o press:

Analyzed
viewInteraction.ts#L1-218
Agora entendo o problema. Na linha 134-148, quando o bot√£o esquerdo √© clicado na vista 3D (!isOrthographic) e n√£o acerta um marcador, a les√£o √© criada imediatamente no pointerdown. Isso impede a rota√ß√£o com orbit controls.

A solu√ß√£o: gravar a posi√ß√£o inicial no pointerdown, e s√≥ criar a les√£o no pointerup se o mouse n√£o se moveu (click real vs. drag para rota√ß√£o).

Edited
viewInteraction.ts
+287
-217
Checked command status
HMR aplicado sem erros. Vamos confirmar que os testes continuam passando:

Ran background command
Go to Terminal
‚Ä¶\ENDOMAPPER-3D-ROTACIONAL > npx vitest run

 ‚úì client/src/__tests__/drawingEngine.test.ts (11 tests) 6ms
 ‚úì client/src/__tests__/lesionStore.test.ts (12 tests) 7ms                      
 ‚úì shared/3d/projections.test.ts (16 tests) 7ms
 ‚úì client/src/__tests__/drawingHistory.test.ts (14 tests) 4ms
 ‚úì client/src/__tests__/screenshotUtils.test.ts (5 tests) 3ms
                                                    
 Test Files  5 passed (5)                               
      Tests  58 passed (58)              
   Start at  17:23:51                                                          ironment 5.22s)                                                                  
   Duration  1.52s (transform 221ms, setup 682ms, import 306ms, tests 26ms, envi

Always run
Exit code 0
Checked command status
‚úÖ 58 testes passando. Aqui est√° o resumo da mudan√ßa:

Como funciona agora
A√ß√£o	Antes	Depois
Clique esquerdo est√°tico (press + soltar sem mover)	Criava marcador imediatamente no pointerdown	Cria marcador no pointerup ‚Äî funciona igual
Clique esquerdo + arrastar (rota√ß√£o)	Criava marcador E depois rotacionava üò°	S√≥ rotaciona ‚Äî nenhum marcador criado ‚úÖ
Clique em marcador existente	Seleciona + arrasta	Sem mudan√ßa
Clique direito em vista ortogr√°fica	Cria marcador	Sem mudan√ßa
Duplo-clique em marcador	Remove marcador	Sem mudan√ßa
Mec√¢nica
No pointerdown: grava a posi√ß√£o inicial do cursor (n√£o cria nada)
No pointermove: se o cursor se moveu mais de 5px, cancela o "pendingClick" (√© rota√ß√£o)
No pointerup: se o cursor se moveu m